<%*
/* 
  è«‹æ³¨æ„ï¼šé€™å€‹æ¨¡æ¿åªé©ç”¨æ–¼æª”åä¸­å«æœ‰ä»¥ä¸‹é—œéµå­—ä¹‹ä¸€ï¼š
  - è—¥åŠ‘å­¸  â†’ å°æ‡‰ "YG_"
  - è—¥ç‰©åˆ†æ â†’ å°æ‡‰ "yF"
  - ç”Ÿè—¥ä¸­è—¥ â†’ å°æ‡‰ "ç”Ÿè—¥ä¸­è—¥"
  - è—¥ç†è—¥åŒ– â†’ å°æ‡‰ "è—¥ç†è—¥åŒ–"

  è‹¥æª”åä¸åŒ…å«é€™äº›é—œéµå­—ï¼Œæ¨¡æ¿å°‡å›å‚³éŒ¯èª¤è¨Šæ¯ã€‚
*/

// å–å¾—æª”åï¼ˆä¸å«å‰¯æª”åï¼‰
let title = tp.file.title;

// é å…ˆå®šç¾©æª”åèˆ‡ prefix çš„å°æ‡‰ mapping
let mapping = {
  "è—¥åŠ‘å­¸": "YG_",
  "è—¥ç‰©åˆ†æ": "yF ",
  "ç”Ÿè—¥ä¸­è—¥": "ç”Ÿè—¥ä¸­è—¥ ",
  "è—¥ç†è—¥åŒ–": "è—¥ç†è—¥åŒ– "
};

let prefix = null;
// æª¢æŸ¥ç•¶å‰æª”åæ˜¯å¦åŒ…å«å…¶ä¸­ä¸€å€‹é—œéµå­—
for (let key in mapping) {
  if (title.indexOf(key) !== -1) {  // è‹¥æª”åä¸­æœ‰é—œéµå­—
    prefix = mapping[key];
    break;
  }
}

// è‹¥ prefix é‚„æ²’è¨­å®šï¼Œå‰‡è¡¨ç¤ºæª”åä¸ç¬¦æ¢ä»¶
if (!prefix) {
  tR = "Error: é€™ä»½æ¨¡æ¿åƒ…é©ç”¨æ–¼æª”ååŒ…å«ã€Œè—¥åŠ‘å­¸ã€ã€ã€Œè—¥ç‰©åˆ†æã€ã€ã€Œç”Ÿè—¥ä¸­è—¥ã€æˆ–ã€Œè—¥ç†è—¥åŒ–ã€çš„æª”æ¡ˆã€‚";
  return;
}

// æç¤ºç”¨æˆ¶è¼¸å…¥é¡Œç›®è³‡è¨Šï¼Œæ ¼å¼: é¡Œç›®ç·¨è™Ÿ å­é¡Œè™Ÿï¼Œä¾‹å¦‚ "114-1 2"
let userInput = await tp.system.prompt("è«‹è¼¸å…¥é¡Œç›®è³‡è¨Š (æ ¼å¼ï¼šé¡Œç›®ç·¨è™Ÿ å­é¡Œè™Ÿï¼Œä¾‹å¦‚ â€œ114-1 2â€):");
if (!userInput) { 
  tR = "æœªè¼¸å…¥é¡Œç›®è³‡è¨Š";
  return;
}

// ä»¥ç©ºæ ¼åˆ†å‰²ç”¨æˆ¶è¼¸å…¥
let partsInput = userInput.split(" ");
let qNumber = partsInput[0] || "æœªçŸ¥";
let qSub = partsInput[1] || "";

// çµ„åˆå…§éƒ¨é€£çµï¼Œæ ¼å¼ç‚ºï¼šPREFIX + é¡Œè™Ÿ#é¡Œè™Ÿ(å­é¡Œè™Ÿ)
// ä¾‹å¦‚ï¼šYG_114-1#114-1(2)
let internalLink = `${prefix}${qNumber}#${qNumber}(${qSub})`;

// è¼¸å‡ºæœ€çµ‚æ¨™é¡Œï¼šä½¿ç”¨ Markdown æ¨™é¡Œæ ¼å¼
tR = `# é¡Œç›®[[${internalLink}]]`;
%>
(**å¦‚æœé€£çµç„¡æ•ˆï¼Œå¯è‡ªè¡Œå¾åº•ä¸‹çˆ¬èŸ²è²¼ä¸Šæœ‰å•é¡Œéƒ¨åˆ†**)ï¼Œä½¿ç”¨ ==æ¨™ç¤º== çªé¡¯æœ‰å•é¡Œçš„éƒ¨åˆ†ï¼Œæœå°‹ç¯„åœä¾æ“šæª”åè€Œæœ‰è®Š
```dataviewjs
let qNumber = "<%- qNumber %>";
let subNumber = "<%- qSub %>";
let prefix = "<%- prefix%>"
let pattern = new RegExp(`^\\s*#####\\s+${qNumber}\\(${subNumber}\\)[\\s\\S]*?(?=\\?\\?\\?|\\Z)`, "gm");

let pages = dv.pages().where(p =>
  p.file.path.endsWith(".md") && p.file.path.includes(prefix)
);
let found = false;

for (let page of pages) {
  let content = await dv.io.load(page.file.path);
  let matches = [...content.matchAll(pattern)];

   if (matches.length > 0) {
    found = true;
    dv.header(4, `ğŸ“˜ ${page.file.name} ä¸­æ‰¾åˆ°ï¼š`);
    matches.forEach((m, i) => {
	 let display = m[0].replaceAll("```", "").replace(/\n\?\n/, '\n').trim();
      // ç”¨åŸå§‹æª”æ¡ˆåå»ºç«‹å…§éƒ¨é€£çµ + ç¨‹å¼å€å¡Šé¡¯ç¤º
      dv.paragraph(`â¡ï¸ [[${page.file.name}#${qNumber}(${subNumber})]]`);
      dv.paragraph("```\n" + display + "\n```");
    });
  }
}

if (!found) {
  dv.paragraph("âŒ æ²’æœ‰åœ¨æ•´å€‹ Vault ä¸­æ‰¾åˆ°è©²é¡Œç›®ã€‚");
}

````




### ç™¥çµé»

- 



### æ›´å¥½çš„è§£
- [ ] 
- [ ] 
- [ ] 

- **è¡¨å–®ä¸Šå‚³æ™‚é–“**ï¼š<% tp.date.now("YYYY-MM-DD HH:mm:ss") %>
- å•é¡Œè§£æ±ºè€…ï¼š

---
