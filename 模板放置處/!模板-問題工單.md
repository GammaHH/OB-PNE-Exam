<%*
/* 
  請注意：這個模板只適用於檔名中含有以下關鍵字之一：
  - 藥劑學  → 對應 "YG_"
  - 藥物分析 → 對應 "yF"
  - 生藥中藥 → 對應 "生藥中藥"
  - 藥理藥化 → 對應 "藥理藥化"

  若檔名不包含這些關鍵字，模板將回傳錯誤訊息。
*/

// 取得檔名（不含副檔名）
let title = tp.file.title;

// 預先定義檔名與 prefix 的對應 mapping
let mapping = {
  "藥劑學": "YG_",
  "藥物分析": "yF ",
  "生藥中藥": "生藥中藥 ",
  "藥理藥化": "藥理藥化 "
};

let prefix = null;
// 檢查當前檔名是否包含其中一個關鍵字
for (let key in mapping) {
  if (title.indexOf(key) !== -1) {  // 若檔名中有關鍵字
    prefix = mapping[key];
    break;
  }
}

// 若 prefix 還沒設定，則表示檔名不符條件
if (!prefix) {
  tR = "Error: 這份模板僅適用於檔名包含「藥劑學」、「藥物分析」、「生藥中藥」或「藥理藥化」的檔案。";
  return;
}

// 提示用戶輸入題目資訊，格式: 題目編號 子題號，例如 "114-1 2"
let userInput = await tp.system.prompt("請輸入題目資訊 (格式：題目編號 子題號，例如 “114-1 2”):");
if (!userInput) { 
  tR = "未輸入題目資訊";
  return;
}

// 以空格分割用戶輸入
let partsInput = userInput.split(" ");
let qNumber = partsInput[0] || "未知";
let qSub = partsInput[1] || "";

// 組合內部連結，格式為：PREFIX + 題號#題號(子題號)
// 例如：YG_114-1#114-1(2)
let internalLink = `${prefix}${qNumber}#${qNumber}(${qSub})`;

// 輸出最終標題：使用 Markdown 標題格式
tR = `# 題目[[${internalLink}]]`;
%>
(**如果連結無效，可自行從底下爬蟲貼上有問題部分**)，使用 ==標示== 突顯有問題的部分，搜尋範圍依據檔名而有變
```dataviewjs
let qNumber = "<%- qNumber %>";
let subNumber = "<%- qSub %>";
let prefix = "<%- prefix%>"
let pattern = new RegExp(`^\\s*#####\\s+${qNumber}\\(${subNumber}\\)[\\s\\S]*?(?=\\?\\?\\?|\\Z)`, "gm");

let pages = dv.pages().where(p =>
  p.file.path.endsWith(".md") && p.file.path.includes(prefix)
);
let found = false;

for (let page of pages) {
  let content = await dv.io.load(page.file.path);
  let matches = [...content.matchAll(pattern)];

   if (matches.length > 0) {
    found = true;
    dv.header(4, `📘 ${page.file.name} 中找到：`);
    matches.forEach((m, i) => {
	 let display = m[0].replaceAll("```", "").replace(/\n\?\n/, '\n').trim();
      // 用原始檔案名建立內部連結 + 程式區塊顯示
      dv.paragraph(`➡️ [[${page.file.name}#${qNumber}(${subNumber})]]`);
      dv.paragraph("```\n" + display + "\n```");
    });
  }
}

if (!found) {
  dv.paragraph("❌ 沒有在整個 Vault 中找到該題目。");
}

````




### 癥結點

- 



### 更好的解
- [ ] 
- [ ] 
- [ ] 

- **表單上傳時間**：<% tp.date.now("YYYY-MM-DD HH:mm:ss") %>
- 問題解決者：

---
