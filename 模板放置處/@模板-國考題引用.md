<%*
// === 1. 定義科別對應表 ===
let folderMap = {
  YG: "!一階國考題/藥劑學",
  YF: "!一階國考題/藥分",
  SCY: "!一階國考題/生藥中藥",
  YH: "!一階國考題/藥理藥化"
};

let qNumber = "", qSub = "", subjectCode = "", targetFolder = null;
let input = "", parts = [];
let errorMsg = "";

// === 使用 while 反覆詢問直到輸入正確 ===
while (true) {
  input = await tp.system.prompt(`${errorMsg}請鍵入【題號 子題號 科別簡寫(YG / YF / SCY / YH)】，例如：114-1 2 YG`);
  if (!input) {
    tR = "⚠️ 有內鬼，中止交易。";
    return;
  }

  parts = input.trim().split(" ");
  if (parts.length !== 3) {
    errorMsg = "⚠️ 有內鬼，請使用正確格式。\n";
    continue;
  }

  [qNumber, qSub, subjectCode] = parts;
  subjectCode = subjectCode.toUpperCase();

  if (!(subjectCode in folderMap)) {
    errorMsg = "⚠️ 無效簡寫（僅限：YG / YF / SCY / YH）\n";
    continue;
  }

  targetFolder = folderMap[subjectCode];
  break;
}
%>
```dataviewjs
let qNumber = "<%- qNumber %>";
let subNumber = "<%- qSub %>";
let folderFilter = "<%- targetFolder %>";
let pattern = new RegExp(`^\\s*#####\\s+${qNumber}\\(${subNumber}\\)[\\s\\S]*?(?=\\?\\?\\?|\\Z)`, "gm");

let pages = dv.pages().where(p =>
  p.file.path.endsWith(".md") && p.file.path.includes(folderFilter)
);
let found = false;

for (let page of pages) {
  let content = await dv.io.load(page.file.path);
  let matches = [...content.matchAll(pattern)];
  
  


  if (matches.length > 0) {
    found = true;
    dv.header(4, `📘 ${page.file.name} 中找到：`);
    matches.forEach((m, i) => {
	  let display = m[0].replaceAll("```", "").replace(/\n\?\n/, '\n').trim();
      // 用原始檔案名建立內部連結 + 程式區塊顯示
      dv.paragraph(`➡️ [[${page.file.name}#${qNumber}(${subNumber})]]`);
      dv.paragraph("```\n" + display + "\n```");
    });
  }
}

if (!found) {
  dv.paragraph("❌ 沒有在整個 Vault 中找到該題目。");
}

```