<%*
// === 1. å®šç¾©ç§‘åˆ¥å°æ‡‰è¡¨ ===
let folderMap = {
  YG: "!ä¸€éšåœ‹è€ƒé¡Œ/è—¥åŠ‘å­¸",
  YF: "!ä¸€éšåœ‹è€ƒé¡Œ/è—¥åˆ†",
  SCY: "!ä¸€éšåœ‹è€ƒé¡Œ/ç”Ÿè—¥ä¸­è—¥",
  YH: "!ä¸€éšåœ‹è€ƒé¡Œ/è—¥ç†è—¥åŒ–"
};

let qNumber = "", qSub = "", subjectCode = "", targetFolder = null;
let input = "", parts = [];
let errorMsg = "";

// === ä½¿ç”¨ while åè¦†è©¢å•ç›´åˆ°è¼¸å…¥æ­£ç¢º ===
while (true) {
  input = await tp.system.prompt(`${errorMsg}è«‹éµå…¥ã€é¡Œè™Ÿ å­é¡Œè™Ÿ ç§‘åˆ¥ç°¡å¯«(YG / YF / SCY / YH)ã€‘ï¼Œä¾‹å¦‚ï¼š114-1 2 YG`);
  if (!input) {
    tR = "âš ï¸ æœ‰å…§é¬¼ï¼Œä¸­æ­¢äº¤æ˜“ã€‚";
    return;
  }

  parts = input.trim().split(" ");
  if (parts.length !== 3) {
    errorMsg = "âš ï¸ æœ‰å…§é¬¼ï¼Œè«‹ä½¿ç”¨æ­£ç¢ºæ ¼å¼ã€‚\n";
    continue;
  }

  [qNumber, qSub, subjectCode] = parts;
  subjectCode = subjectCode.toUpperCase();

  if (!(subjectCode in folderMap)) {
    errorMsg = "âš ï¸ ç„¡æ•ˆç°¡å¯«ï¼ˆåƒ…é™ï¼šYG / YF / SCY / YHï¼‰\n";
    continue;
  }

  targetFolder = folderMap[subjectCode];
  break;
}
%>
```dataviewjs
let qNumber = "<%- qNumber %>";
let subNumber = "<%- qSub %>";
let folderFilter = "<%- targetFolder %>";
let pattern = new RegExp(`^\\s*#####\\s+${qNumber}\\(${subNumber}\\)[\\s\\S]*?(?=\\?\\?\\?|\\Z)`, "gm");

let pages = dv.pages().where(p =>
  p.file.path.endsWith(".md") && p.file.path.includes(folderFilter)
);
let found = false;

for (let page of pages) {
  let content = await dv.io.load(page.file.path);
  let matches = [...content.matchAll(pattern)];
  
  


  if (matches.length > 0) {
    found = true;
    dv.header(4, `ğŸ“˜ ${page.file.name} ä¸­æ‰¾åˆ°ï¼š`);
    matches.forEach((m, i) => {
	  let display = m[0].replaceAll("```", "").replace(/\n\?\n/, '\n').trim();
      // ç”¨åŸå§‹æª”æ¡ˆåå»ºç«‹å…§éƒ¨é€£çµ + ç¨‹å¼å€å¡Šé¡¯ç¤º
      dv.paragraph(`â¡ï¸ [[${page.file.name}#${qNumber}(${subNumber})]]`);
      dv.paragraph("```\n" + display + "\n```");
    });
  }
}

if (!found) {
  dv.paragraph("âŒ æ²’æœ‰åœ¨æ•´å€‹ Vault ä¸­æ‰¾åˆ°è©²é¡Œç›®ã€‚");
}

```