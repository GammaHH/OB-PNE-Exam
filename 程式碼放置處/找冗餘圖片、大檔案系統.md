---
created: 2025-07-21 23:38
updated: 2025-07-22 15:42
---
- 偵測未連結的圖片檔案(限制50項)

```dataviewjs
const imageExts = ["png", "jpg", "jpeg", "gif", "webp"];
const allImages = app.vault.getFiles().filter(f => {
  let ext = f.extension.toLowerCase();
  return imageExts.includes(ext);
});

let imageUsage = new Map();

for (let img of allImages) {
  imageUsage.set(img.path, { used: false, file: img });
}

for (let file of app.vault.getMarkdownFiles()) {
  const content = await app.vault.read(file);

  for (let img of allImages) {
    const imgName = img.name;
    const regex = new RegExp(`!?\\[\\[${imgName}\\]\\]`, "gi");
    if (regex.test(content)) {
      imageUsage.get(img.path).used = true;
    }
  }
}

const unusedImages = [...imageUsage.values()]
  .filter(info => !info.used)
  .slice(0, 50); // ⭐️ 限制最多顯示 50 筆

if (unusedImages.length === 0) {
  dv.paragraph("✅ 所有圖片都有被使用！");
} else {
  dv.paragraph(`🧹 以下是未被使用的圖片（前 50 筆），共 ${unusedImages.length} 筆：`);

  let output = unusedImages.map((info, index) => `${index + 1}. [[${info.file.name}]]`).join("\n");
  dv.paragraph(output);
}
```



- 偵測所有檔案，依照大小排序(前50)

```dataviewjs
const allFiles = app.vault.getFiles();

let filesWithSize = allFiles.map(f => ({
  name: f.name,
  path: f.path,
  size: f.stat.size
}));

// 按大小由大到小排序
filesWithSize.sort((a, b) => b.size - a.size);

// 限制前 50 筆
let top50 = filesWithSize.slice(0, 50);

// 格式化成表格資料（KB 顯示）
let tableRows = top50.map(f => [
  `[[${f.name}]]`,
  (f.size / 1024).toFixed(2) + " KB",
  f.path
]);

// 顯示表格
dv.table(["檔名", "大小", "路徑"], tableRows);

```